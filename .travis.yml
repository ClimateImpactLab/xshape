# This file was autogenerated and will overwrite each time you run travis_pypi_setup.py

language: python
python:
- 3.5
- 3.6
- 2.7

env:
  matrix:
  - TEST_ENV=tox
  - TEST_ENV=conda

install:
- pip install --upgrade pip
- if [[ "$TEST_ENV" == "conda" ]]; then
    if [[ "$TRAVIS_PYTHON_VERSION" == "2.7" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh;
    else
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    fi;
    bash miniconda.sh -b -p $HOME/miniconda;
    export PATH="$HOME/miniconda/bin:$PATH";
    hash -r;
    conda config --set always_yes yes --set changeps1 no;
    conda update -q conda;
    conda info -a;
    
    conda create -n test_env python=$TRAVIS_PYTHON_VERSION --yes;
    source activate test_env;

    python setup.py install;
    python -m pip install -r requirements_dev.txt;
    conda install --yes --file requirements_conda.txt;
  else
    pip install -U tox-travis;
  fi

script:
- if [[ "$TEST_ENV" == "conda" ]]; then
    pytest &&
    sphinx-apidoc -o docs xshape &&
    sphinx-build -W -b html -d docs/_build/doctrees docs/. docs/_build/html;
  else
    tox;
  fi;

after_success:
- coveralls

deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: delgadom
  password:
    secure: !!binary |
      TVI0bHQ2NkpFNllaUFNLc29rMm5ncFhLQ0NCVHNpUzV5ZDNEQncxdnV2YUR6eUEzSHEwMkJpRTV2
      Sm55cnlYbzFicVF3Y0JaaUFOY002WkQxN25JT2I3Um45Q3hYU3VQTVFybWdpRVpwVjMxS0ptcjFk
      dUhEcHNJcVFwZ3JIV3Bxa0FnbVNNdllaQURCS0dSdHhhSVozaG9QY2V0NXpnY0dReENmYmxNNkFY
      ZmJUU2ZyaFZQdE1veDB1L1RRMEk5ZXd5N3l5SXJCVW5PVVVnb3FnQ2xHNDRYOE90eVErb1ZpVUp2
      WTRWS0ljak5CRUlHRnNUY1JPTjRNSTByZXNIeENlbitmQVpMeEpLZFRzd25pT0J2WmR4V3VUR2pl
      TkhyL1JlVkdTWTIvalcyYW5oSTQvSlh2K2x3ei8zSlk2WGdaWFd2YlJzMUpFdldYbXBVVmdTQWtQ
      YU1kWHZveTFwY0pCbDI0aVNRSWY1R3ByemdJNnBPUm12ZlR1cm81azRyNmZDaXVhYWtoQnVVYkZy
      OVNpdGZWdG41eEpobm9oRnh4WnNtSkNnK05LMTEreXBXckdoQWRnQzFId2ozQ3dxaWlsWW1WalBy
      M1V5M3Z1bEUzMkZOUWVPc3g0aGtJa3hXYVdZb1haTm5xa3FQbmZVeGhLVHVlbldydkJpRXR6RTF4
      UFpjMSs2dTVDUm1KNkpUNGZhakYxTWEvY0VZakd2NGVlanZCaHZjbE8wM2cwV1hoV3QzY1AvTzR3
      SHpleG4rV3VZcnM5bitlcG1IcFNVT29mdVpRSVNNZW9HMk5Mc01OYWY1RVNVZXlpN1VGVmNsUmN5
      Y2ZId3pJZmxTRElma1UweVM2bkwxQkoyR1dSTVBHVlNOcURENTBEYkM0U3NPemU0UEVoRGhaSHM9
  true:
    branch: master
    python: 2.7
    repo: ClimateImpactLab/xshape